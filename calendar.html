<!--

Calendar
--------

Based on https://neatnik.net/calendar

--

MIT License

Copyright (c) 2025 Neatnik LLC

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
<style>
@import url('https://fonts.bunny.net/css?family=oswald:300,400');
@media print {
  @page {
    size: auto;
    margin: 0;
  }
  html, body {
    width: 100%;
    height: 100%;
  }
  .weekend {
    background: #d8d8d8 !important;
  }
  .today {
    box-shadow: none !important;
  }
}
html {
  font-family: 'Oswald';
}
html, body {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}
table {
  width: 100%;
  height: 100%;
  border-collapse: separate;
  border-spacing: .5em 0;
  table-layout: fixed;
}
td, th {
  text-transform: uppercase;
  border-bottom: 1px solid #888;
  padding: 0 .3vmin;
  font-size: .9vmin;
  font-weight: 300;
  color: #000;
  overflow: hidden;
  white-space: nowrap;
  line-height: 1;
  height: calc(100% / 32);
  max-height: calc(100% / 32);
}
th {
  font-size: 1.1vmin;
}
td:empty {
  border: 0;
}
.share-btn {
  width: 100%;
  height: 100%;
  cursor: pointer;
  background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
  color: white;
  border: none;
  border-radius: 4px;
  text-transform: none;
  font-weight: 500;
  font-size: 1.2em;
}
.share-btn:hover {
  background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
}
.help-btn {
  width: 100%;
  height: 100%;
  cursor: pointer;
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
  color: white;
  border: none;
  border-radius: 4px;
  text-transform: none;
  font-weight: 500;
  font-size: 1.2em;
}
.help-btn:hover {
  background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
}
.save-btn {
  width: 100%;
  height: 100%;
  cursor: pointer;
  background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
  color: white;
  border: none;
  border-radius: 4px;
  text-transform: none;
  font-weight: 500;
  font-size: 1.2em;
}
.save-btn:hover {
  background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
}
.save-btn:disabled {
  background: linear-gradient(135deg, #a5b4fc 0%, #818cf8 100%);
  cursor: default;
}
.clear-btn {
  width: 100%;
  height: 100%;
  cursor: pointer;
  background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
  color: white;
  border: none;
  border-radius: 4px;
  text-transform: none;
  font-weight: 500;
  font-size: 1.2em;
}
.clear-btn:hover {
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-overlay.show {
  display: flex;
}
.modal {
  background: white;
  padding: 2em;
  border-radius: 8px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  position: relative;
}
.modal h2 {
  margin-top: 0;
  font-size: 1.5em;
}
.modal p {
  line-height: 1.6;
  color: #333;
}
.modal a {
  color: #3b82f6;
  text-decoration: none;
}
.modal a:hover {
  text-decoration: underline;
}
.modal-close {
  position: absolute;
  top: 0.5em;
  right: 0.5em;
  width: 2em;
  height: 2em;
  background: none;
  border: none;
  font-size: 1.2em;
  cursor: pointer;
  color: #666;
  line-height: 1;
}
.modal-close:hover {
  color: #000;
}
.modal pre {
  background: #f5f5f5;
  padding: 1em;
  border-radius: 4px;
  overflow-x: auto;
  font-size: 0.85em;
  margin: 1em 0;
}
.modal code {
  font-family: 'Consolas', 'Monaco', monospace;
}
@media print {
  .share-btn, .help-btn, .save-btn, .clear-btn, .modal-overlay {
    display: none !important;
  }
}
.date {
  display: inline-block;
  width: 1.1em;
  font-size: 0.9vmin;
}
.day {
  display: inline-block;
  text-align: center;
  width: 1em;
  color: #888;
  font-size: 0.9vmin;
}
.weekend {
  background: #eee;
  font-weight: 400;
}
.today {
  box-shadow: inset 0 0 0 2px #3b82f6;
}
.cell-label {
  font-size: 1em;
  color: #000;
  margin-left: 0.3em;
  text-transform: none;
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  font-weight: 400;
}
* {
  color-adjust: exact;
  -webkit-print-color-adjust: exact;
}
</style>
</head>
<body>
<table id="calendarTable">
  <thead>
    <tr>
      <th id="yearHeader"></th><th>Feb</th><th>Mar</th><th>Apr</th><th>May</th><th>Jun</th>
      <th>Jul</th><th>Aug</th><th>Sep</th><th>Oct</th><th>Nov</th><th>Dec</th>
    </tr>
  </thead>
  <tbody id="calendarBody"></tbody>
</table>

<div id="helpModal" class="modal-overlay">
  <div class="modal">
    <button class="modal-close" onclick="document.getElementById('helpModal').classList.remove('show')">&times;</button>
    <p>Single-page, full-year JavaScript calendar</p>
    <p><strong>Features:</strong></p>
    <ul>
      <li>Today's date is highlighted with a blue border</li>
      <li>Weekends are shaded</li>
      <li>Use the Share button to create a shareable URL</li>
      <li>Customize cells via the JavaScript API in the console</li>
    </ul>
    <p><strong>Example:</strong></p>
    <pre><code class="language-javascript">// Set a label and color for a date
calendar.setCell(12, 25, {
  color: '#fecaca',
  label: '&lt;b&gt;Christmas&lt;/b&gt;',  // HTML supported
  borderLeftColor: '#dc2626',
  borderLeftWidth: '3px',
  borderBottomColor: '#dc2626'});

// Highlight a date range
calendar.setRange(7, 1, 7, 7, {
  color: '#bbf7d0',
  label: 'Vacation'});

// Highlight All Fridays (0=Sun, 6=Sat)
calendar.getDayOfWeekDates(5)
    .forEach(d => calendar.setCell(d.month, d.day, { color: '#ffd0d0' }));
</code></pre>
    <p>For more information, visit:<br>
      <a href="https://github.com/brentp/single-page-js-calendar" target="_blank">github.com/brentp/single-page-js-calendar</a>
    </p>
  </div>
</div>

<script>
const calendar = (function() {
  const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
  const monthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  
  let currentYear = 2026;
  let cellData = {}; // Store custom colors/labels: { "2026-01-15": { color: "#ff0", label: "Birthday" } }
  let isDirty = false; // Track unsaved changes
  
  function markDirty() {
    isDirty = true;
    updateSaveButtonStyle();
  }
  
  function markClean() {
    isDirty = false;
    updateSaveButtonStyle();
  }
  
  function updateSaveButtonStyle() {
    const btn = document.getElementById('saveBtn');
    if (btn) {
      btn.style.fontWeight = isDirty ? 'bold' : '500';
    }
  }
  
  function isLeapYear(year) {
    return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
  }
  
  function getDaysInMonth(year, month) {
    if (month === 1 && isLeapYear(year)) return 29;
    return monthDays[month];
  }
  
  function getDayOfWeek(year, month, day) {
    return new Date(year, month, day).getDay();
  }
  
  function isWeekend(year, month, day) {
    const dow = getDayOfWeek(year, month, day);
    return dow === 0 || dow === 6;
  }
  
  function dateKey(year, month, day) {
    const m = String(month + 1).padStart(2, '0');
    const d = String(day).padStart(2, '0');
    return `${year}-${m}-${d}`;
  }
  
  function getCell(month, day) {
    const key = dateKey(currentYear, month, day);
    const cell = document.querySelector(`td[data-date="${key}"]`);
    return cell;
  }
  
  function render(year) {
    if (year) currentYear = year;
    
    document.getElementById('yearHeader').textContent = currentYear + ' Jan';
    
    const tbody = document.getElementById('calendarBody');
    tbody.innerHTML = '';
    
    // Get today's date for comparison
    const now = new Date();
    const todayKey = dateKey(now.getFullYear(), now.getMonth(), now.getDate());
    
    for (let day = 1; day <= 31; day++) {
      const row = document.createElement('tr');
      
      for (let month = 0; month < 12; month++) {
        const cell = document.createElement('td');
        const daysInMonth = getDaysInMonth(currentYear, month);
        
        if (day <= daysInMonth) {
          const key = dateKey(currentYear, month, day);
          cell.setAttribute('data-date', key);
          
          // Mark today's date
          if (key === todayKey) {
            cell.classList.add('today');
          }
          
          const dow = getDayOfWeek(currentYear, month, day);
          if (isWeekend(currentYear, month, day)) {
            cell.classList.add('weekend');
          }
          
          // Apply stored customizations
          const data = cellData[key];
          if (data) {
            if (data.color) cell.style.backgroundColor = data.color;
            if (data.textColor) cell.style.color = data.textColor;
            if (data.borderBottomColor) cell.style.borderBottomColor = data.borderBottomColor;
            if (data.borderBottomWidth) cell.style.borderBottomWidth = data.borderBottomWidth;
            if (data.borderLeftColor) {
              cell.style.borderLeftColor = data.borderLeftColor;
              cell.style.borderLeftStyle = 'solid';
            }
            if (data.borderLeftWidth) cell.style.borderLeftWidth = data.borderLeftWidth;
          }
          
          const dateSpan = document.createElement('span');
          dateSpan.className = 'date';
          dateSpan.textContent = day;
          
          const daySpan = document.createElement('span');
          daySpan.className = 'day';
          daySpan.textContent = dayNames[dow];
          
          cell.appendChild(dateSpan);
          cell.appendChild(document.createTextNode(' '));
          cell.appendChild(daySpan);
          
          // Add label if exists
          if (data && data.label) {
            cell.style.verticalAlign = 'top';
            const labelSpan = document.createElement('span');
            labelSpan.className = 'cell-label';
            labelSpan.innerHTML = data.label;
            labelSpan.title = data.label.replace(/<[^>]*>/g, '');
            if (data.fontFamily) labelSpan.style.fontFamily = data.fontFamily;
            if (data.fontSize) labelSpan.style.fontSize = data.fontSize;
            if (data.fontWeight) labelSpan.style.fontWeight = data.fontWeight;
            if (data.fontStyle) labelSpan.style.fontStyle = data.fontStyle;
            cell.appendChild(labelSpan);
          }
        } else if (day === 31 && month === 10) {
          // Nov 31 doesn't exist - add Share button here
          cell.style.borderBottom = 'none';
          cell.style.padding = '0';
          const btn = document.createElement('button');
          btn.className = 'share-btn';
          btn.textContent = 'Share';
          btn.onclick = async () => {
            const b64 = await exportData(true);
            const url = new URL(window.location.href);
            url.search = `?data=${b64}`;
            window.location.href = url.toString();
          };
          cell.appendChild(btn);
        } else if (day === 31 && month === 8) {
          // Sep 31 doesn't exist - add Help button here
          cell.style.borderBottom = 'none';
          cell.style.padding = '0';
          const btn = document.createElement('button');
          btn.className = 'help-btn';
          btn.textContent = 'Help (?)';
          btn.onclick = () => {
            document.getElementById('helpModal').classList.add('show');
          };
          cell.appendChild(btn);
        } else if (day === 31 && month === 5) {
          // Jun 31 doesn't exist - add Save button here
          cell.style.borderBottom = 'none';
          cell.style.padding = '0';
          const btn = document.createElement('button');
          btn.className = 'save-btn';
          btn.id = 'saveBtn';
          btn.textContent = 'Save';
          btn.onclick = () => {
            saveToLocalStorage();
            btn.textContent = 'Saved';
            btn.disabled = true;
            setTimeout(() => {
              btn.textContent = 'Save';
              btn.disabled = false;
              updateSaveButtonStyle();
            }, 2000);
          };
          cell.appendChild(btn);
        } else if (day === 31 && month === 3) {
          // Apr 31 doesn't exist - add Clear button here
          cell.style.borderBottom = 'none';
          cell.style.padding = '0';
          const btn = document.createElement('button');
          btn.className = 'clear-btn';
          btn.textContent = 'Clear';
          btn.onclick = () => {
            clearAll();
          };
          cell.appendChild(btn);
        }
        
        row.appendChild(cell);
      }
      
      tbody.appendChild(row);
    }
  }
  
  // API Methods
  
  /**
   * Set properties for a date cell
   * @param {number} month - Month (1-12)
   * @param {number} day - Day of month (1-31)
   * @param {object} options - { color, textColor, label, fontFamily, fontSize, fontWeight, fontStyle, borderBottomColor, borderBottomWidth, borderLeftColor, borderLeftWidth }
   */
  function setCell(month, day, options) {
    const key = dateKey(currentYear, month - 1, day);
    if (!cellData[key]) cellData[key] = {};
    
    const cell = getCell(month - 1, day);
    
    if (options.color) {
      cellData[key].color = options.color;
      if (cell) cell.style.backgroundColor = options.color;
    }
    if (options.textColor) {
      cellData[key].textColor = options.textColor;
      if (cell) cell.style.color = options.textColor;
    }
    if (options.label) {
      cellData[key].label = options.label;
      if (cell) {
        cell.style.verticalAlign = 'top';
        let labelSpan = cell.querySelector('.cell-label');
        if (!labelSpan) {
          labelSpan = document.createElement('span');
          labelSpan.className = 'cell-label';
          cell.appendChild(labelSpan);
        }
        labelSpan.innerHTML = options.label;
        labelSpan.title = options.label.replace(/<[^>]*>/g, '');
      }
    }
    if (options.fontFamily) {
      cellData[key].fontFamily = options.fontFamily;
      if (cell) {
        let labelSpan = cell.querySelector('.cell-label');
        if (labelSpan) labelSpan.style.fontFamily = options.fontFamily;
      }
    }
    if (options.fontSize) {
      cellData[key].fontSize = options.fontSize;
      if (cell) {
        let labelSpan = cell.querySelector('.cell-label');
        if (labelSpan) labelSpan.style.fontSize = options.fontSize;
      }
    }
    if (options.fontWeight) {
      cellData[key].fontWeight = options.fontWeight;
      if (cell) {
        let labelSpan = cell.querySelector('.cell-label');
        if (labelSpan) labelSpan.style.fontWeight = options.fontWeight;
      }
    }
    if (options.fontStyle) {
      cellData[key].fontStyle = options.fontStyle;
      if (cell) {
        let labelSpan = cell.querySelector('.cell-label');
        if (labelSpan) labelSpan.style.fontStyle = options.fontStyle;
      }
    }
    if (options.borderBottomColor) {
      cellData[key].borderBottomColor = options.borderBottomColor;
      if (cell) cell.style.borderBottomColor = options.borderBottomColor;
    }
    if (options.borderBottomWidth) {
      cellData[key].borderBottomWidth = options.borderBottomWidth;
      if (cell) cell.style.borderBottomWidth = options.borderBottomWidth;
    }
    if (options.borderLeftColor) {
      cellData[key].borderLeftColor = options.borderLeftColor;
      if (cell) {
        cell.style.borderLeftColor = options.borderLeftColor;
        cell.style.borderLeftStyle = 'solid';
      }
    }
    if (options.borderLeftWidth) {
      cellData[key].borderLeftWidth = options.borderLeftWidth;
      if (cell) cell.style.borderLeftWidth = options.borderLeftWidth;
    }
    markDirty();
  }
  
  /**
   * Clear all customizations for a date
   * @param {number} month - Month (1-12)
   * @param {number} day - Day of month (1-31)
   */
  function clearCell(month, day) {
    const key = dateKey(currentYear, month - 1, day);
    delete cellData[key];
    markDirty();
    render();
  }
  
  /**
   * Clear all customizations
   */
  function clearAll() {
    cellData = {};
    markDirty();
    render();
  }
  
  /**
   * Highlight a range of dates
   * @param {number} startMonth - Start month (1-12)
   * @param {number} startDay - Start day
   * @param {number} endMonth - End month (1-12)
   * @param {number} endDay - End day
   * @param {object} options - { color, textColor, label }
   */
  function setRange(startMonth, startDay, endMonth, endDay, options) {
    const start = new Date(currentYear, startMonth - 1, startDay);
    const end = new Date(currentYear, endMonth - 1, endDay);
    
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
      setCell(d.getMonth() + 1, d.getDate(), options);
    }
  }
  
  /**
   * Get all Sundays in the year
   * @returns {Array} Array of {month, day} objects
   */
  function getSundays() {
    const sundays = [];
    for (let month = 0; month < 12; month++) {
      const days = getDaysInMonth(currentYear, month);
      for (let day = 1; day <= days; day++) {
        if (getDayOfWeek(currentYear, month, day) === 0) {
          sundays.push({ month: month + 1, day });
        }
      }
    }
    return sundays;
  }
  
  /**
   * Get all dates for a specific day of week
   * @param {number} dayOfWeek - 0=Sunday, 1=Monday, ..., 6=Saturday
   * @returns {Array} Array of {month, day} objects
   */
  function getDayOfWeekDates(dayOfWeek) {
    const dates = [];
    for (let month = 0; month < 12; month++) {
      const days = getDaysInMonth(currentYear, month);
      for (let day = 1; day <= days; day++) {
        if (getDayOfWeek(currentYear, month, day) === dayOfWeek) {
          dates.push({ month: month + 1, day });
        }
      }
    }
    return dates;
  }
  
  /**
   * Compress a string using deflate
   * @param {string} str - String to compress
   * @returns {Promise<Uint8Array>} Compressed bytes
   */
  async function compress(str) {
    const stream = new Blob([str]).stream();
    const compressed = stream.pipeThrough(new CompressionStream('deflate'));
    return new Uint8Array(await new Response(compressed).arrayBuffer());
  }
  
  /**
   * Decompress deflate-compressed bytes
   * @param {Uint8Array} bytes - Compressed bytes
   * @returns {Promise<string>} Decompressed string
   */
  async function decompress(bytes) {
    const stream = new Blob([bytes]).stream();
    const decompressed = stream.pipeThrough(new DecompressionStream('deflate'));
    return new Response(decompressed).text();
  }
  
  /**
   * Export current cell data as a JavaScript object
   * @returns {object} Object with year and cells properties
   */
  function exportJSONData() {
    return { year: currentYear, cells: { ...cellData } };
  }
  
  /**
   * Import cell data from a JavaScript object
   * @param {object} data - Object with year and cells properties
   */
  function importJSONData(data) {
    if (data.year) currentYear = data.year;
    cellData = data.cells || {};
    markDirty();
    render();
  }
  
  /**
   * Export current cell data as JSON
   * @param {boolean} base64 - If true, return compressed base64-encoded string (async)
   * @returns {string|Promise<string>} JSON string or Promise resolving to compressed base64
   */
  function exportData(base64) {
    const data = exportJSONData();
    const json = JSON.stringify(data);
    if (base64) {
      return compress(json).then(bytes => {
        let binary = '';
        bytes.forEach(b => binary += String.fromCharCode(b));
        // Use URL-safe base64: replace + with - and / with _
        return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_');
      });
    }
    return JSON.stringify(data, null, 2);
  }
  
  /**
   * Import cell data from JSON
   * @param {string} json - JSON string from exportData()
   */
  function importData(json) {
    const data = JSON.parse(json);
    importJSONData(data);
  }
  
  /**
   * Get the current year
   * @returns {number}
   */
  function getYear() {
    return currentYear;
  }
  
  /**
   * Save current calendar data to localStorage
   * @param {string} [name='calendarData'] - Storage key name
   */
  function saveToLocalStorage(name) {
    const key = name || 'calendarData';
    const data = exportJSONData();
    localStorage.setItem(key, JSON.stringify(data));
    markClean();
  }
  
  /**
   * Load calendar data from localStorage
   * @param {string} [name='calendarData'] - Storage key name
   * @param {boolean} [merge=false] - If true, merge with current data instead of replacing
   * @returns {boolean} True if data was loaded
   */
  function loadFromLocalStorage(name, merge) {
    const key = name || 'calendarData';
    const stored = localStorage.getItem(key);
    if (stored) {
      try {
        const data = JSON.parse(stored);
        if (merge) {
          // Merge: keep current year unless not set, combine cells
          if (data.cells) {
            cellData = { ...cellData, ...data.cells };
          }
          markDirty();
        } else {
          // Replace
          if (data.year) currentYear = data.year;
          cellData = data.cells || {};
        }
        render();
        return true;
      } catch (e) {
        console.error('Failed to parse localStorage data:', e);
      }
    }
    return false;
  }
  
  /**
   * Clear localStorage data
   * @param {string} [name='calendarData'] - Storage key name
   */
  function clearLocalStorage(name) {
    const key = name || 'calendarData';
    localStorage.removeItem(key);
  }
  
  /**
   * Decode base64 compressed data param
   * @param {string} b64 - Base64 encoded compressed data
   * @returns {Promise<object>} Parsed data object
   */
  async function decodeDataParam(b64) {
    // Convert URL-safe base64 back to standard base64
    const standardB64 = b64.replace(/-/g, '+').replace(/_/g, '/');
    const binary = atob(standardB64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) {
      bytes[i] = binary.charCodeAt(i);
    }
    const json = await decompress(bytes);
    return JSON.parse(json);
  }
  
  // Initialize with URL params or localStorage
  const urlParams = new URLSearchParams(window.location.search);
  const yearParam = urlParams.get('year');
  const dataParam = urlParams.get('data');
  
  if (dataParam) {
    decodeDataParam(dataParam).then(data => {
      currentYear = data.year;
      cellData = data.cells || {};
      render();
    }).catch(e => {
      console.error('Failed to parse data parameter:', e);
      render();
    });
    // Render will be called after async decode
    document.addEventListener('DOMContentLoaded', () => {});
  } else {
    // Try loading from localStorage first (don't render yet, wait for DOM)
    const key = 'calendarData';
    const stored = localStorage.getItem(key);
    if (stored) {
      try {
        const data = JSON.parse(stored);
        if (data.year) currentYear = data.year;
        cellData = data.cells || {};
      } catch (e) {
        console.error('Failed to parse localStorage data:', e);
      }
    }
    
    // Year param overrides localStorage year
    if (yearParam) {
      currentYear = parseInt(yearParam, 10);
    }
    // Initial render on load
    document.addEventListener('DOMContentLoaded', () => render());
  }
  
  // Public API
  return {
    render,
    setCell,
    clearCell,
    clearAll,
    setRange,
    getSundays,
    getDayOfWeekDates,
    exportJSONData,
    importJSONData,
    exportData,
    importData,
    getYear,
    saveToLocalStorage,
    loadFromLocalStorage,
    clearLocalStorage
  };
})();

// Keyboard shortcuts for help modal
document.addEventListener('keydown', (e) => {
  const modal = document.getElementById('helpModal');
  if (e.key === 'Escape' && modal.classList.contains('show')) {
    modal.classList.remove('show');
  } else if (e.key === '?' && !modal.classList.contains('show')) {
    modal.classList.add('show');
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
</body>
</html>
